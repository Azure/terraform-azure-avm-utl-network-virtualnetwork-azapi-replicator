module "replicator" {
  source = "../../"

  name                = "acctestvirtnet${random_integer.number.result}"
  resource_group_name = azurerm_resource_group.test.name
  resource_group_id   = azurerm_resource_group.test.id
  location            = azurerm_resource_group.test.location
  address_space       = ["10.0.0.0/16"]

  subnet = [
    {
      name                                          = "subnet1"
      address_prefixes                              = ["10.0.1.0/24"]
      default_outbound_access_enabled               = true
      id                                            = ""
      private_endpoint_network_policies             = "Disabled"
      private_link_service_network_policies_enabled = true
      route_table_id                                = ""
      security_group                                = ""
      service_endpoint_policy_ids                   = []
      service_endpoints                             = []
      delegation                                    = []
    }
  ]

  tags = {
    t0  = "v0"
    t1  = "v1"
    t2  = "v2"
    t3  = "v3"
    t4  = "v4"
    t5  = "v5"
    t6  = "v6"
    t7  = "v7"
    t8  = "v8"
    t9  = "v9"
    t10 = "v10"
    t11 = "v11"
    t12 = "v12"
    t13 = "v13"
    t14 = "v14"
    t15 = "v15"
    t16 = "v16"
    t17 = "v17"
    t18 = "v18"
    t19 = "v19"
    t20 = "v20"
    t21 = "v21"
    t22 = "v22"
    t23 = "v23"
    t24 = "v24"
    t25 = "v25"
    t26 = "v26"
    t27 = "v27"
    t28 = "v28"
    t29 = "v29"
    t30 = "v30"
    t31 = "v31"
    t32 = "v32"
    t33 = "v33"
    t34 = "v34"
    t35 = "v35"
    t36 = "v36"
    t37 = "v37"
    t38 = "v38"
    t39 = "v39"
    t40 = "v40"
    t41 = "v41"
    t42 = "v42"
    t43 = "v43"
    t44 = "v44"
    t45 = "v45"
    t46 = "v46"
    t47 = "v47"
    t48 = "v48"
    t49 = "v49"
  }
}

resource "azapi_resource" "this" {
  type                             = module.replicator.azapi_header.type
  name                             = module.replicator.azapi_header.name
  location                         = module.replicator.azapi_header.location
  parent_id                        = module.replicator.azapi_header.parent_id
  tags                             = module.replicator.azapi_header.tags
  body                             = module.replicator.body
  ignore_null_property             = module.replicator.azapi_header.ignore_null_property
  sensitive_body                   = module.replicator.sensitive_body
  sensitive_body_version           = module.replicator.sensitive_body_version
  replace_triggers_external_values = module.replicator.replace_triggers_external_values
  locks                            = module.replicator.locks
  retry                            = module.replicator.retry

  dynamic "identity" {
    for_each = can(module.replicator.azapi_header.identity) ? [module.replicator.identity] : []
    content {
      type         = identity.value.type
      identity_ids = try(identity.value.identity_ids, null)
    }
  }

  dynamic "timeouts" {
    for_each = module.replicator.timeouts != null ? [module.replicator.timeouts] : []
    content {
      create = timeouts.value.create
      delete = timeouts.value.delete
      read   = timeouts.value.read
      update = timeouts.value.update
    }
  }
}
