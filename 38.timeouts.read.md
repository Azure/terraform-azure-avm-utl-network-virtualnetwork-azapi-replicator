# Task #38 - timeouts.read

## Summary
Verified and documented the `read` timeout field configuration for `azurerm_virtual_network`. The default timeout value of 5 minutes has been correctly extracted from provider source code and implemented in `variables.tf`. This is a Terraform provider meta-argument (not an Azure API property) that controls read operation timeout duration.

## Provider Schema Evidence

From `resourceVirtualNetwork()` in `github.com/hashicorp/terraform-provider-azurerm/internal/services/network`:

```go
func resourceVirtualNetwork() *pluginsdk.Resource {
	return &pluginsdk.Resource{
		Create:   resourceVirtualNetworkCreate,
		Read:     resourceVirtualNetworkRead,
		Update:   resourceVirtualNetworkUpdate,
		Delete:   resourceVirtualNetworkDelete,
		Importer: pluginsdk.ImporterValidatingIdentity(&commonids.VirtualNetworkId{}),

		Timeouts: &pluginsdk.ResourceTimeout{
			Create: pluginsdk.DefaultTimeout(30 * time.Minute),
			Read:   pluginsdk.DefaultTimeout(5 * time.Minute),  // <- 5 minutes for READ
			Update: pluginsdk.DefaultTimeout(30 * time.Minute),
			Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
		},

		Schema: resourceVirtualNetworkSchema(),

		Identity: &schema.ResourceIdentity{
			SchemaFunc: pluginsdk.GenerateIdentitySchema(&commonids.VirtualNetworkId{}),
		},
	}
}
```

**Default Read Timeout Value:**
- **Provider:** `pluginsdk.DefaultTimeout(5 * time.Minute)`
- **Converted:** `"5m"`

## Create Phase Verification

**Pattern:** Meta-block (N/A for Azure API)

The `timeouts.read` field is a Terraform provider meta-argument that specifies the timeout duration for read operations. It is NOT part of the Azure API request body.

**Evidence:**
- Default value: **5 minutes**
- This is a resource-level meta-argument, not a request body property
- The timeout controls how long the provider waits for the `Get` operation to complete during read/refresh operations

## Implementation Verification

### Current Implementation in `variables.tf`

```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "30m")
    delete = optional(string, "30m")
    read   = optional(string, "5m")  # <- Matches default block
    update = optional(string, "30m")
  })
  default     = {
    create = "30m"
    delete = "30m"
    read   = "5m"  # <- Synchronized with type definition
    update = "30m"
  }
  nullable    = false
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 30 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 30 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.
 - `update` - (Optional) Specifies the timeout for update operations. Defaults to 30 minutes.
EOT
}
```

**Verification Points:**
- ✅ Type definition: `optional(string, "5m")` - Correct default
- ✅ Default block: `read = "5m"` - Synchronized with type definition
- ✅ Nullable: `false` - Correctly set to prevent null values
- ✅ Description: "Defaults to 5 minutes" - Accurate documentation

### Output in `migrate_outputs.tf`

```hcl
output "timeouts" { value = var.timeouts }
```

This output enables the parent module to pass the timeout values directly to its `azapi_resource` block.

## Assignment Path Verification

**N/A** - The `timeouts` block is a meta-argument, not mapped to Azure API properties. There is no assignment path in the Azure API request body.

## Mapping

**N/A** - Meta-argument (not mapped to Azure API)

The `timeouts.read` field does not map to any Azure API property. It controls how long the Terraform provider waits for the read operation to complete.

## Special Handling

### Meta-Argument Pattern

The `timeouts.read` field follows the meta-argument pattern:
1. **Variable definition:** Defined in `timeouts` object with `optional(string, "5m")`
2. **Default value:** Set in `default` block to `"5m"`
3. **Output:** Passed to parent module via `output "timeouts"`
4. **Parent module usage:** Configures `azapi_resource.timeouts.read` directly

### No ForceNew Behavior

Changes to the `read` timeout value do **NOT** trigger resource replacement. The timeout only affects the duration the provider waits for read operations to complete.

### No Shadow Module Implementation

**No changes** to `migrate_main.tf` or other shadow module locals. The `timeouts.read` field is NOT part of:
- `local.body`
- `local.sensitive_body`
- `local.azapi_header`
- `local.replace_triggers_external_values`

### Duration Format

- **Provider format:** Go duration (`5 * time.Minute`)
- **Terraform format:** String duration (`"5m"`)
- **Conversion:** `5 * time.Minute` → `"5m"`

## Hidden Fields

**N/A** - The `timeouts` block is a meta-argument with no expand/flatten functions in the provider source code.

## Deferred Work Completion

No `following.md` file exists. No deferred work to complete.

## Critical Review & Edge Case Analysis

### Null Semantics
- **Variable level:** `nullable = false` prevents null assignment
- **Field level:** `optional(string, "5m")` provides default value
- **Result:** The `read` timeout always has a defined value of "5m" unless explicitly overridden

### Boundary Conditions
- **Empty string:** Not allowed - Terraform's duration parser will reject it
- **Invalid format:** Validated by Terraform (must be valid duration like "5m", "1h", "90s")
- **Zero duration:** `"0s"` or `"0m"` technically valid but impractical for API operations
- **Very long duration:** No upper limit enforced by provider (e.g., "24h" is valid)

### Idempotency
- Timeout value changes don't affect resource state
- Multiple applies with same timeout are idempotent
- Timeout value doesn't influence API request body content

### Safe References
- The `var.timeouts.read` is guaranteed to have a value due to:
  - `nullable = false` at variable level
  - `optional(string, "5m")` at field level
  - `default { read = "5m" }` at default block level
- Direct field access is safe without null checks

### Duration Validation
- Terraform validates duration string format automatically
- Valid formats: "5m", "1h30m", "90s", "1.5h"
- Provider uses this timeout value for polling Azure API operation completion during read/refresh operations

### Read Operation Context
- Read timeout is used during:
  - Initial resource creation (post-create refresh)
  - Explicit `terraform refresh` commands
  - `terraform plan` operations that read current state
  - Data source reads
- Shorter default (5m) compared to create/update/delete (30m) reflects that read operations are typically faster
- Read operations don't modify resources, only retrieve current state

## Checklist

- ✅ Property in correct local: N/A (meta-argument, not in locals)
- ✅ ForceNew wrapped: N/A (timeouts don't trigger replacement)
- ✅ ALL logic EXACTLY replicated from provider: Default timeout value extracted from provider source code
- ✅ Validations IMPLEMENTED in variables.tf: N/A (Terraform validates duration format)
- ✅ TODO comment added to original field: N/A (no sensitive fields)
- ✅ Hidden fields checked: N/A (no expand function for meta-argument)
- ✅ Deferred work in following.md: None
- ✅ Deferred work from following.md: None
- ✅ Critical review: Completed (see Edge Case Analysis)
- ✅ Edge Case Analysis in proof: Completed above
- ✅ Proof created: This document
- ✅ `track.md` updated to Pending for check: Will update next
- ✅ Self-Review: Only documented timeouts.read field, no other fields added

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2026-01-06
**Task:** #38 - timeouts.read

### Validation Results

✅ **Provider Schema Evidence:** Correctly extracted `pluginsdk.DefaultTimeout(5 * time.Minute)` from provider source code
✅ **Type Definition:** `optional(string, "5m")` - Correct default value
✅ **Default Block Synchronization:** `read = "5m"` matches type definition (CRITICAL requirement per timeouts.md)
✅ **Nullable Setting:** `nullable = false` correctly set to prevent null values
✅ **Description:** Accurately documents "Defaults to 5 minutes"
✅ **Output Configuration:** `output "timeouts"` exists in migrate_outputs.tf
✅ **No Shadow Module Changes:** Correctly documented that meta-arguments don't require body/sensitive_body implementation
✅ **Deferred Work:** No following.md exists, no deferred work to complete
✅ **Edge Cases:** Comprehensive edge case analysis covering null semantics, boundary conditions, idempotency, and safe references
✅ **Proof Document Quality:** All required sections present, no forbidden phrases detected

### Critical Compliance Check - timeouts.md Requirements

**✅ VERIFIED:** The implementation satisfies all critical requirements from `timeouts.md`:

1. **Default Value Extraction:** ✅ Correctly queried provider source code to extract `5 * time.Minute`
2. **String Conversion:** ✅ Properly converted Go duration to Terraform format: `5 * time.Minute` → `"5m"`
3. **Type Definition Default:** ✅ Used `optional(string, "5m")` with inline default
4. **Default Block Synchronization:** ✅ **CRITICAL** - `default { read = "5m" }` exactly matches `optional(string, "5m")`
5. **Nullable Setting:** ✅ Explicitly set `nullable = false`
6. **Description Update:** ✅ Updated to reflect correct default value
7. **Output Configuration:** ✅ Verified `output "timeouts"` exists

### Compliance Statement

This implementation EXACTLY replicates the provider behavior as required by `executor.md` and `timeouts.md`. The read timeout default of 5 minutes has been correctly extracted from the provider source code and properly synchronized across both the type definition (`optional(string, "5m")`) and the default block (`read = "5m"`). This synchronization is a **CRITICAL** requirement per `timeouts.md` lines 60-67 and has been verified. No deviations, simplifications, or "safer alternatives" were found.

**Status:** APPROVED ✅

---
