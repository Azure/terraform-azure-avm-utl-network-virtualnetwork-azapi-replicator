# Task #37 - timeouts.create

## Summary
Verified and documented the `create` timeout field configuration for `azurerm_virtual_network`. The default timeout value of 30 minutes has been correctly extracted from provider source code and implemented in `variables.tf`. This is a Terraform provider meta-argument (not an Azure API property) that controls create operation timeout duration.

## Provider Schema Evidence

From `resourceVirtualNetwork()` in `github.com/hashicorp/terraform-provider-azurerm/internal/services/network`:

```go
func resourceVirtualNetwork() *pluginsdk.Resource {
	return &pluginsdk.Resource{
		Create:   resourceVirtualNetworkCreate,
		Read:     resourceVirtualNetworkRead,
		Update:   resourceVirtualNetworkUpdate,
		Delete:   resourceVirtualNetworkDelete,
		Importer: pluginsdk.ImporterValidatingIdentity(&commonids.VirtualNetworkId{}),

		Timeouts: &pluginsdk.ResourceTimeout{
			Create: pluginsdk.DefaultTimeout(30 * time.Minute),  // <- 30 minutes for CREATE
			Read:   pluginsdk.DefaultTimeout(5 * time.Minute),
			Update: pluginsdk.DefaultTimeout(30 * time.Minute),
			Delete: pluginsdk.DefaultTimeout(30 * time.Minute),
		},

		Schema: resourceVirtualNetworkSchema(),

		Identity: &schema.ResourceIdentity{
			SchemaFunc: pluginsdk.GenerateIdentitySchema(&commonids.VirtualNetworkId{}),
		},
	}
}
```

**Default Create Timeout Value:**
- **Provider:** `pluginsdk.DefaultTimeout(30 * time.Minute)`
- **Converted:** `"30m"`

## Create Phase Verification

**Pattern:** Meta-block (N/A for Azure API)

The `timeouts.create` field is a Terraform provider meta-argument that specifies the timeout duration for create operations. It is NOT part of the Azure API request body.

**Evidence:**
- Default value: **30 minutes**
- This is a resource-level meta-argument, not a request body property
- The timeout controls how long the provider waits for the `CreateOrUpdateThenPoll` operation to complete

## Implementation Verification

### Current Implementation in `variables.tf`

```hcl
variable "timeouts" {
  type = object({
    create = optional(string, "30m")  # <- Matches default block
    delete = optional(string, "30m")
    read   = optional(string, "5m")
    update = optional(string, "30m")
  })
  default     = {
    create = "30m"  # <- Synchronized with type definition
    delete = "30m"
    read   = "5m"
    update = "30m"
  }
  nullable    = false
  description = <<-EOT
 - `create` - (Optional) Specifies the timeout for create operations. Defaults to 30 minutes.
 - `delete` - (Optional) Specifies the timeout for delete operations. Defaults to 30 minutes.
 - `read` - (Optional) Specifies the timeout for read operations. Defaults to 5 minutes.
 - `update` - (Optional) Specifies the timeout for update operations. Defaults to 30 minutes.
EOT
}
```

**Verification Points:**
- ✅ Type definition: `optional(string, "30m")` - Correct default
- ✅ Default block: `create = "30m"` - Synchronized with type definition
- ✅ Nullable: `false` - Correctly set to prevent null values
- ✅ Description: "Defaults to 30 minutes" - Accurate documentation

### Output in `migrate_outputs.tf`

```hcl
output "timeouts" { value = var.timeouts }
```

This output enables the parent module to pass the timeout values directly to its `azapi_resource` block.

## Assignment Path Verification

**N/A** - The `timeouts` block is a meta-argument, not mapped to Azure API properties. There is no assignment path in the Azure API request body.

## Mapping

**N/A** - Meta-argument (not mapped to Azure API)

The `timeouts.create` field does not map to any Azure API property. It controls how long the Terraform provider waits for the create operation to complete.

## Special Handling

### Meta-Argument Pattern

The `timeouts.create` field follows the meta-argument pattern:
1. **Variable definition:** Defined in `timeouts` object with `optional(string, "30m")`
2. **Default value:** Set in `default` block to `"30m"`
3. **Output:** Passed to parent module via `output "timeouts"`
4. **Parent module usage:** Configures `azapi_resource.timeouts.create` directly

### No ForceNew Behavior

Changes to the `create` timeout value do **NOT** trigger resource replacement. The timeout only affects the duration the provider waits for create operations to complete.

### No Shadow Module Implementation

**No changes** to `migrate_main.tf` or other shadow module locals. The `timeouts.create` field is NOT part of:
- `local.body`
- `local.sensitive_body`
- `local.azapi_header`
- `local.replace_triggers_external_values`

### Duration Format

- **Provider format:** Go duration (`30 * time.Minute`)
- **Terraform format:** String duration (`"30m"`)
- **Conversion:** `30 * time.Minute` → `"30m"`

## Hidden Fields

**N/A** - The `timeouts` block is a meta-argument with no expand/flatten functions in the provider source code.

## Deferred Work Completion

No `following.md` file exists. No deferred work to complete.

## Critical Review & Edge Case Analysis

### Null Semantics
- **Variable level:** `nullable = false` prevents null assignment
- **Field level:** `optional(string, "30m")` provides default value
- **Result:** The `create` timeout always has a defined value of "30m" unless explicitly overridden

### Boundary Conditions
- **Empty string:** Not allowed - Terraform's duration parser will reject it
- **Invalid format:** Validated by Terraform (must be valid duration like "30m", "1h", "90s")
- **Zero duration:** `"0s"` or `"0m"` technically valid but impractical for API operations
- **Very long duration:** No upper limit enforced by provider (e.g., "24h" is valid)

### Idempotency
- Timeout value changes don't affect resource state
- Multiple applies with same timeout are idempotent
- Timeout value doesn't influence API request body content

### Safe References
- The `var.timeouts.create` is guaranteed to have a value due to:
  - `nullable = false` at variable level
  - `optional(string, "30m")` at field level
  - `default { create = "30m" }` at default block level
- Direct field access is safe without null checks

### Duration Validation
- Terraform validates duration string format automatically
- Valid formats: "30m", "1h30m", "90s", "1.5h"
- Provider uses this timeout value for polling Azure API operation completion

## Checklist

- ✅ Property in correct local: N/A (meta-argument, not in locals)
- ✅ ForceNew wrapped: N/A (timeouts don't trigger replacement)
- ✅ ALL logic EXACTLY replicated from provider: Default timeout value extracted from provider source code
- ✅ Validations IMPLEMENTED in variables.tf: N/A (Terraform validates duration format)
- ✅ TODO comment added to original field: N/A (no sensitive fields)
- ✅ Hidden fields checked: N/A (no expand function for meta-argument)
- ✅ Deferred work in following.md: None
- ✅ Deferred work from following.md: None
- ✅ Critical review: Completed (see Edge Case Analysis)
- ✅ Edge Case Analysis in proof: Completed above
- ✅ Proof created: This document
- ✅ `track.md` updated to Pending for check: Will update next
- ✅ Self-Review: Only documented timeouts.create field, no other fields added

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2026-01-06
**Task:** #37 - timeouts.create

### Validation Results

✅ **Provider Schema:** Default timeout value (30 minutes) correctly extracted from provider source code
✅ **Variable Type Definition:** Correctly uses `optional(string, "30m")` in type definition
✅ **Default Block Synchronization:** `default { create = "30m" }` matches type definition default value
✅ **Nullable Setting:** `nullable = false` correctly set to prevent null values
✅ **Description:** Accurately documents "Defaults to 30 minutes"
✅ **Output Configuration:** `output "timeouts"` exists in `migrate_outputs.tf`
✅ **Shadow Module:** Correctly has NO implementation in `migrate_main.tf` (timeouts is a meta-argument)
✅ **Special Handling:** Follows timeouts.md override document rules exactly
✅ **Deferred Work Completion:** No `following.md` file exists, no deferred work to complete
✅ **Edge Cases:** Duration format validation handled by Terraform automatically

### Compliance Statement

This implementation EXACTLY replicates the provider behavior as required by `executor.md` and `timeouts.md`. The timeout meta-argument is correctly configured with:
- Default value extracted from provider source code (`pluginsdk.DefaultTimeout(30 * time.Minute)` → `"30m"`)
- Type definition and default block properly synchronized
- Proper nullable constraint to ensure value is always defined
- No shadow module implementation (correct for meta-arguments)

No deviations, simplifications, or "safer alternatives" were found.

**Status:** APPROVED ✅

---
